<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML>
<HEAD>
<TITLE>
Engine
</TITLE>
</HEAD>
<FONT SIZE="+2"><B>Engine</B></FONT><BR><BR><HR>
<FONT SIZE="+1"><B>Overview</B></FONT><BR>
<P>
No Documentation Specified
<BR><HR><BR>
<B>Parents</B>
<A HREF="../../../../Root/XCore/Object/index.html">Object</A>
,<A HREF="../../../../Root/XCore/Element/index.html">Element</A>
<BR><HR><BR>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Constructors</B></FONT></TD>
</TR>
<TR><TD>Engine()</TD><TD> No Documentation </TD></TR>
</TABLE>
<BR><HR><BR>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=3><FONT SIZE="+2">
<B>Attributes</B></FONT></TD>
</TR>
<TR><TD><B>RESULT</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Integer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>TOCS</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Integer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>TOFS</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Integer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>callStack</B></TD><TD><A HREF="../../../../Root/XCore/Vector/index.html">Vector<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>charPosStack</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Seq(Integer)<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>consumeToken</B></TD><TD><A HREF="../../../../Root/XCore/Boolean/index.html">Boolean<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>expected</B></TD><TD><A HREF="../../../../Root/XCore/Buffer/index.html">Buffer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>fail</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Integer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>failStack</B></TD><TD><A HREF="../../../../Root/XCore/Vector/index.html">Vector<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>frame</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Integer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>imports</B></TD><TD><A HREF="../../../../Root/XCore/NameSpace/index.html">Seq(NameSpace)<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>lastToken</B></TD><TD><A HREF="../../../../Root/XCore/String/index.html">String<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>maxCharPos</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Integer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>parseError</B></TD><TD><A HREF="../../../../Root/XCore/Boolean/index.html">Boolean<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>token</B></TD><TD><A HREF="../../../../Root/XCore/String/index.html">String<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>tokenizer</B></TD><TD><A HREF="../../../../Root/Parser/Tokens/Tokenizer/index.html">Tokenizer<A></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B>type</B></TD><TD><A HREF="../../../../Root/XCore/Integer/index.html">Integer<A></TD><TD>No Documentation Specified</TD></TR>
<TR>
<TD COLSPAN=3>
<FONT SIZE="-1">
<B>From</B> <A HREF="../../../../Root/XCore/Element/index.html">Element</A>: roleFiller. <BR></FONT>
</TD>
</TR>
</TABLE>
<BR><HR><BR>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="2" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Operations</B></FONT></TD>
</TR>
<TR><TD><B><a href="#atClassifier">atClassifier</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#atNameSpace">atNameSpace</a>():<A HREF="../../../../Root/XCore/NameSpace/index.html">NameSpace<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#atPath">atPath</a>():<A HREF="../../../../Root/XCore/String/index.html">Seq(String)<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#call">call</a>(grammar:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,indent:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,name:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,argMap:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,isTailCall:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#code">code</a>():<A HREF="../../../../Root/Parser/BNF/Recognizer/index.html">Seq(Recognizer)<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#cut">cut</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#debug0">debug0</a>(message:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#debug1">debug1</a>(message:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,arg:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#debug2">debug2</a>(message:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,arg1:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,arg2:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#debug3">debug3</a>(message:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,arg1:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,arg2:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,arg3:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#debugFailCall">debugFailCall</a>(clause:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#dupFrame">dupFrame</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#expected">expected</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#fail">fail</a>(expected:<A HREF="../../../../Root/XCore/String/index.html">String<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#failCall">failCall</a>(clause:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#getSource">getSource</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#linePos">linePos</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#nextToken">nextToken</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#parse">parse</a>(args:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,target:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,grammar:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,code:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,tokenizer:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,imports:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#parse">parse</a>(target:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,grammar:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,code:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,tokenizer:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,imports:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#parseError">parseError</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#popChar">popChar</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#popFail">popFail</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#popFrame">popFrame</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#popInstrs">popInstrs</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#printFail">printFail</a>(fail:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#printFrame">printFrame</a>(frame:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#pushCall">pushCall</a>(prev:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,grammar:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,code:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,indent:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,target:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,cut:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,locals:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#pushChar">pushChar</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#pushFail">pushFail</a>(prev:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,fail:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,charPos:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,grammar:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,code:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,indent:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,target:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,cut:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,token:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,type:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,name:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>,argMap:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#readChar">readChar</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#readChars">readChars</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#readLine">readLine</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#reset">reset</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#setExpected">setExpected</a>(v:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#setLocation">setLocation</a>(value:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#setParseError">setParseError</a>(v:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#startAt">startAt</a>(classifier:<A HREF="../../../../Root/XCore/Element/index.html">Element<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#toString">toString</a>():<A HREF="../../../../Root/XCore/String/index.html">String<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#typeCheck">typeCheck</a>(path:<A HREF="../../../../Root/XCore/String/index.html">Seq(String)<A>):<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR><TD><B><a href="#unwindFail">unwindFail</a>():<A HREF="../../../../Root/XCore/Element/index.html">Element<A></B></TD><TD>No Documentation Specified</TD></TR>
<TR>
<TD COLSPAN=2>
<FONT SIZE="-1">
<B>From</B> <A HREF="../../../../Root/XCore/Object/index.html">Object</A>: addDaemon, addDiagramListener, addMissingSlot, addMultiDaemon, addPersistentDaemon, addStructuralFeature, allCompositeValues, allCompositeValuesAndSelf, allDaemonsWithId, allDaemonsWithTarget, applyMapping_client, calcChildrenSlots, changedOnDiagram, compositeValues, daemonNamed, daemonWithId, daemonWithIdAndTarget, daemons, daemonsActive, destroyDaemon, edit, fire, get, getAvailableMappings, getChildren, getChildrenSlots, getChildrenToolTips, getDiagramListenerNamed, getDiagramListeners, getProperties, getProperty, getStructuralFeatureNames, hasDaemonNamed, hasDaemonWithId, hasDaemonWithIdAndTarget, hasDaemonWithTarget, hasProperty, hasSlot, hasStructuralFeature, hotLoad, hotLoaded, ignoreBy, ignoreByAll, init, initSlots, machineInit, nodeEvent, observeBy, observeBy, observedBy, observedBy, oldEdit, orderSequence, orderSequence, propertyTarget, removeDaemon, removeDaemonNamed, removeDaemonsWithId, removeDaemonsWithTarget, removeDiagramListener, removeDiagramListeners, removeStructuralFeature, renameSlot, saveXTO, saveXTOFile, set, setDaemons, setDaemonsActive, setHotLoad, setProperty, showAndLayoutDiagram, showDiagram, slotDenied, slotMissing, slotMissing, slots, synchronise. <BR><B>From</B> <A HREF="../../../../Root/XCore/Element/index.html">Element</A>: addTo, allHTMLEntries, allHTMLPackages, assignToGlobal, assignToGlobal, browse, browse_redirect, checkConstraints, copy, copyToClipboard, copyToClipboard_transaction, createDiagram, createDiagramType, createDiagramType, createDiagramType, createTool, cutToClipboard, cutToClipboard_transaction, deleteRecursive, deployXML, die, doc, doubleClick, edit, edit_redirect, equals, error, evaluateExpression, ferror, getChildren, getChildrenToolTips, getDefaultClipboardSource, getDefaultClipboardTarget, graphVizNode, hashCode, init, init, invokeOp, isDeleteProtected, isKindOf, isProtected, isReallyKindOf, isTypeOf, isViewProtected, isWithinNameSpace, labelString, legalNameChangeCheck, legalSlotChangeCheck, legalSlotChangeCheck, lift, nameString, noOperationFound, oclIsKindOf, oclIsTypeOf, of, oldShowDiagram, pasteFromClipboard, populateGraphViz, pprint, pprint, pprint, pprintln, print, println, removeDaemon, removeDaemon, save, save2, selectDiagram, selectModelBrowserNode, send, setDelegation, setOf, setRoleFillerDialog, showAndLayoutDiagram, showDiagram, showModelBrowserNode, slotAffectsLabel, systemId, toHTML, toSVG, toSnapshot, toSnapshot, toString, toType, writeHTML, writeHTML, writeHTMLAllEntries, writeHTMLAllPackages, writeHTMLIndex, writeHTMLOverview, writeXML, writeXMLFile, yield. <BR><TR><TD COLSPAN=2><a name="atClassifier"/><FONT FACE="Courier" SIZE="1">@Operation&#160;atClassifier():XCore::Element<br>&#160;&#160;let&#160;names&#160;=&#160;RESULT<br>&#160;&#160;in&#160;if&#160;names.isKindOf(SeqOfElement)<br>&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;rootName&#160;=&#160;names-&gt;at(0);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elementNames&#160;=&#160;names-&gt;tail&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nameSpaces&#160;=&#160;imports-&gt;select(nameSpace&#160;|<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;nameSpace.hasElement(rootName))<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;nameSpaces-&gt;isEmpty<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;throw&#160;AtError("Cannot&#160;find&#160;"&#160;+&#160;rootName&#160;+&#160;"&#160;perhaps&#160;you&#160;need&#160;to&#160;import&#160;it.",tokenizer.buffer().toString(),maxCharPos,names,imports)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;elementNames-&gt;iterate(name&#160;nameSpace&#160;=&#160;nameSpaces-&gt;head.getElement(rootName)&#160;|<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;value&#160;=&#160;nameSpace.getElement(name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;value&#160;=&#160;null<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.error("At:&#160;"&#160;+&#160;nameSpace.toString()&#160;+&#160;"::"&#160;+&#160;name&#160;+&#160;"&#160;does&#160;not&#160;exist.")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;value<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;else&#160;self.error("At:&#160;expecting&#160;a&#160;sequence&#160;of&#160;names,&#160;got&#160;"&#160;+&#160;names.toString())<br>&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="atNameSpace"/><FONT FACE="Courier" SIZE="1">@Operation&#160;atNameSpace():NameSpace<br>&#160;&#160;let&#160;names&#160;=&#160;RESULT<br>&#160;&#160;in&#160;if&#160;names.isKindOf(SeqOfElement)<br>&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;rootName&#160;=&#160;names-&gt;at(0);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elementNames&#160;=&#160;names-&gt;tail<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;elementNames-&gt;iterate(name&#160;nameSpace&#160;=&#160;Kernel_getVar(rootName)&#160;|<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;nameSpace.hasElement(name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;nameSpace.getElement(name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;self.error("At:&#160;"&#160;+&#160;nameSpace.toString()&#160;+&#160;"::"&#160;+&#160;name&#160;+&#160;"&#160;does&#160;not&#160;exist.")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;else&#160;self.error("At:&#160;expecting&#160;a&#160;sequence&#160;of&#160;names,&#160;got&#160;"&#160;+&#160;names.toString())<br>&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="atPath"/><FONT FACE="Courier" SIZE="1">@Operation&#160;atPath():Seq(String)<br>&#160;&#160;if&#160;type&#160;=&#160;NAME<br>&#160;&#160;then&#160;let&#160;path&#160;=&#160;Seq{token.toString()};<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;isPath&#160;=&#160;true<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;@While&#160;isPath&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;charPos&#160;=&#160;tokenizer.charPos()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.nextToken();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;token.stringEqual("::")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;type&#160;=&#160;NAME<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;path&#160;:=&#160;path&#160;+&#160;Seq{token.toString()}<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;self.error("::&#160;must&#160;be&#160;followed&#160;by&#160;name:&#160;"&#160;+&#160;path)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;tokenizer.setCharPos(charPos);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;isPath&#160;:=&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;path<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;else&#160;self.error("@&#160;must&#160;be&#160;followed&#160;by&#160;a&#160;path.")<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="call"/><FONT FACE="Courier" SIZE="1">@Operation&#160;call(grammar&#160;:&#160;XCore::Element,indent&#160;:&#160;XCore::Element,name&#160;:&#160;XCore::Element,argMap&#160;:&#160;XCore::Element,isTailCall&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;self.debug1("Try&#160;",name)<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;;<br>&#160;&#160;let&#160;clause&#160;=&#160;grammar.clauseNamed(name)<br>&#160;&#160;in&#160;if&#160;clause&#160;=&#160;null<br>&#160;&#160;&#160;&#160;&#160;then&#160;self.error(formats("No&#160;clause&#160;named&#160;~S&#160;in&#160;~{,~;~S~}",Seq{name,grammar.clauses.name-&gt;asSeq}))<br>&#160;&#160;&#160;&#160;&#160;else&#160;let&#160;blocks&#160;=&#160;clause.predict(grammar,token,type)&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;target&#160;=&#160;callStack.ref(frame&#160;+&#160;TARGET)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;blocks-&gt;isEmpty<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.failCall(clause)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;blocks-&gt;size&#160;=&#160;1<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;code&#160;=&#160;blocks-&gt;head.instrs();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;locals&#160;=&#160;blocks-&gt;head.locals();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;frameMap&#160;=&#160;blocks-&gt;head.argMap();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;prev&#160;=&#160;frame<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;isTailCall&#160;and&#160;argMap-&gt;isEmpty<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.TOCS&#160;:=&#160;frame;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.frame&#160;:=&#160;callStack.ref(frame&#160;+&#160;PREV_FRAME)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.frame&#160;:=&#160;self.pushCall(frame,grammar,code,indent,target,fail,locals);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@Count&#160;i&#160;from&#160;0&#160;to&#160;argMap-&gt;size&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;callStack.put(frame&#160;+&#160;LOC0&#160;+&#160;frameMap-&gt;at(i),callStack.ref(prev&#160;+&#160;LOC0&#160;+&#160;argMap-&gt;at(i)))<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;let&#160;prev&#160;=&#160;callStack.ref(frame&#160;+&#160;PREV_FRAME);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;cut&#160;=&#160;callStack.ref(frame&#160;+&#160;CUT);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;locals&#160;=&#160;callStack.ref(frame&#160;+&#160;LOCALS)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;isTailCall&#160;and&#160;argMap-&gt;isEmpty<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.TOCS&#160;:=&#160;frame;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.frame&#160;:=&#160;prev<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;frameMap&#160;=&#160;blocks-&gt;head.argMap();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;prev&#160;=&#160;frame<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.frame&#160;:=&#160;self.pushCall(frame,grammar,blocks-&gt;head.instrs(),indent&#160;+&#160;2,target,fail,blocks-&gt;head.locals());<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@Count&#160;i&#160;from&#160;0&#160;to&#160;argMap-&gt;size&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;arg&#160;=&#160;callStack.ref(prev&#160;+&#160;LOC0&#160;+&#160;argMap-&gt;at(i))<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;callStack.put(frame&#160;+&#160;LOC0&#160;+&#160;frameMap-&gt;at(i),arg)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.pushFail(prev,fail,tokenizer.charPos(),grammar,blocks-&gt;tail,indent,target,fail,token.toString(),type,name,argMap)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="code"/><FONT FACE="Courier" SIZE="1">@Operation&#160;code():Seq(Recognizer)<br>&#160;&#160;callStack.ref(frame&#160;+&#160;CODE)<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="cut"/><FONT FACE="Courier" SIZE="1">@Operation&#160;cut():XCore::Element<br>&#160;&#160;self.fail&#160;:=&#160;callStack.ref(frame&#160;+&#160;CUT);<br>&#160;&#160;if&#160;fail&#160;&gt;=&#160;0<br>&#160;&#160;then&#160;self.TOFS&#160;:=&#160;fail&#160;+&#160;FAIL_ARG0&#160;+&#160;failStack.ref(fail&#160;+&#160;FAIL_ARGS)<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="debug0"/><FONT FACE="Courier" SIZE="1">@Operation&#160;debug0(message&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;format(stdout,"~V[~S,~S,~S,~S,~S]~S~%",Seq{callStack.ref(frame&#160;+&#160;INDENT),frame,TOCS,fail,TOFS,consumeToken,message})<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="debug1"/><FONT FACE="Courier" SIZE="1">@Operation&#160;debug1(message&#160;:&#160;XCore::Element,arg&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;format(stdout,"~V[~S,~S,~S,~S,~S]~S~S~%",Seq{callStack.ref(frame&#160;+&#160;INDENT),frame,TOCS,fail,TOFS,consumeToken,message,arg})<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="debug2"/><FONT FACE="Courier" SIZE="1">@Operation&#160;debug2(message&#160;:&#160;XCore::Element,arg1&#160;:&#160;XCore::Element,arg2&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;format(stdout,"~V[~S,~S,~S,~S,~S]~S~S~S~%",Seq{callStack.ref(frame&#160;+&#160;INDENT),frame,TOCS,fail,TOFS,consumeToken,message,arg1,arg2})<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="debug3"/><FONT FACE="Courier" SIZE="1">@Operation&#160;debug3(message&#160;:&#160;XCore::Element,arg1&#160;:&#160;XCore::Element,arg2&#160;:&#160;XCore::Element,arg3&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;format(stdout,"~V[~S,~S,~S,~S,~S]~S~S~S~S~%",Seq{callStack.ref(frame&#160;+&#160;INDENT),frame,TOCS,fail,TOFS,consumeToken,message,arg1,arg2,arg3})<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="debugFailCall"/><FONT FACE="Courier" SIZE="1">@Operation&#160;debugFailCall(clause&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;let&#160;message&#160;=&#160;formats("Fail&#160;~S&#160;not&#160;in&#160;~{,~;~S~}",Seq{token,clause.expected()-&gt;asSeq})<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;format(stdout,"~V[~S,~S,~S,~S,~S]~S~%",Seq{callStack.ref(frame&#160;+&#160;INDENT),frame,TOCS,fail,TOFS,consumeToken,message})<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="dupFrame"/><FONT FACE="Courier" SIZE="1">@Operation&#160;dupFrame():XCore::Element<br>&#160;&#160;let&#160;locals&#160;=&#160;callStack.ref(frame&#160;+&#160;LOCALS)<br>&#160;&#160;in&#160;callStack.put(TOCS&#160;+&#160;PREV_FRAME,callStack.ref(frame&#160;+&#160;PREV_FRAME));<br>&#160;&#160;&#160;&#160;&#160;callStack.put(TOCS&#160;+&#160;GRAMMAR,callStack.ref(frame&#160;+&#160;GRAMMAR));<br>&#160;&#160;&#160;&#160;&#160;callStack.put(TOCS&#160;+&#160;CODE,callStack.ref(frame&#160;+&#160;CODE));<br>&#160;&#160;&#160;&#160;&#160;callStack.put(TOCS&#160;+&#160;INDENT,callStack.ref(frame&#160;+&#160;INDENT));<br>&#160;&#160;&#160;&#160;&#160;callStack.put(TOCS&#160;+&#160;TARGET,callStack.ref(frame&#160;+&#160;TARGET));<br>&#160;&#160;&#160;&#160;&#160;callStack.put(TOCS&#160;+&#160;CUT,callStack.ref(frame&#160;+&#160;CUT));<br>&#160;&#160;&#160;&#160;&#160;callStack.put(TOCS&#160;+&#160;LOCALS,locals);<br>&#160;&#160;&#160;&#160;&#160;@Count&#160;x&#160;from&#160;0&#160;to&#160;locals&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;callStack.put(TOCS&#160;+&#160;LOC0&#160;+&#160;x,callStack.ref(frame&#160;+&#160;LOC0&#160;+&#160;x))<br>&#160;&#160;&#160;&#160;&#160;end;<br>&#160;&#160;&#160;&#160;&#160;self.frame&#160;:=&#160;TOCS;<br>&#160;&#160;&#160;&#160;&#160;self.TOCS&#160;:=&#160;TOCS&#160;+&#160;LOC0&#160;+&#160;locals<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="expected"/><FONT FACE="Courier" SIZE="1">@Operation&#160;expected[ACCESSOR=true]():XCore::Element<br>&#160;&#160;self.expected<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="fail"/><FONT FACE="Courier" SIZE="1">@Operation&#160;fail(expected&#160;:&#160;String):XCore::Element<br>&#160;&#160;if&#160;tokenizer.charPos()&#160;&gt;=&#160;maxCharPos<br>&#160;&#160;then&#160;self.expected.add(expected)<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;;<br>&#160;&#160;self.unwindFail();<br>&#160;&#160;if&#160;fail&#160;&gt;=&#160;0<br>&#160;&#160;then&#160;self.popFail()<br>&#160;&#160;else&#160;throw&#160;TokenExpected(tokenizer.buffer().toString(),maxCharPos,lastToken,self.expected.asSeq()-&gt;asSet)<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="failCall"/><FONT FACE="Courier" SIZE="1">@Operation&#160;failCall(clause&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;self.debugFailCall(clause)<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;;<br>&#160;&#160;self.unwindFail();<br>&#160;&#160;if&#160;tokenizer.charPos()&#160;&gt;=&#160;maxCharPos<br>&#160;&#160;then&#160;@For&#160;term&#160;in&#160;clause.expected()&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;expected.add(term)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;;<br>&#160;&#160;if&#160;fail&#160;&gt;=&#160;0<br>&#160;&#160;then&#160;self.popFail()<br>&#160;&#160;elseif&#160;type&#160;=&#160;EOI<br>&#160;&#160;then&#160;throw&#160;TokenExpected(tokenizer.buffer().toString(),tokenizer.charPos(),"EOF",clause.expected())<br>&#160;&#160;else&#160;throw&#160;TokenExpected(tokenizer.buffer().toString(),maxCharPos,lastToken,expected.asSeq()-&gt;asSet)<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="getSource"/><FONT FACE="Courier" SIZE="1">@Operation&#160;getSource():XCore::Element<br>&#160;&#160;tokenizer.buffer.toString()<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="linePos"/><FONT FACE="Courier" SIZE="1">@Operation&#160;linePos():XCore::Element<br>&#160;&#160;tokenizer.lineCount()<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="nextToken"/><FONT FACE="Courier" SIZE="1">@Operation&#160;nextToken():XCore::Element<br>&#160;&#160;tokenizer.nextToken();<br>&#160;&#160;self.token&#160;:=&#160;tokenizer.token();<br>&#160;&#160;self.type&#160;:=&#160;tokenizer.type();<br>&#160;&#160;if&#160;tokenizer.charPos()&#160;&gt;&#160;maxCharPos<br>&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;self.maxCharPos&#160;:=&#160;tokenizer.charPos();<br>&#160;&#160;&#160;&#160;self.lastToken&#160;:=&#160;token.toString();<br>&#160;&#160;&#160;&#160;expected.setSize(0);<br>&#160;&#160;&#160;&#160;token<br>&#160;&#160;else&#160;token<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="parse"/><FONT FACE="Courier" SIZE="1">@Operation&#160;parse(args&#160;:&#160;XCore::Element,target&#160;:&#160;XCore::Element,grammar&#160;:&#160;XCore::Element,code&#160;:&#160;XCore::Element,tokenizer&#160;:&#160;XCore::Element,imports&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;self.reset();<br>&#160;&#160;self.tokenizer&#160;:=&#160;tokenizer;<br>&#160;&#160;self.imports&#160;:=&#160;imports;<br>&#160;&#160;self.frame&#160;:=&#160;self.pushCall(0&#160;-&#160;1,grammar,code,0,target,0&#160;-&#160;1,args-&gt;size);<br>&#160;&#160;@Count&#160;i&#160;from&#160;0&#160;to&#160;args-&gt;size&#160;do<br>&#160;&#160;&#160;&#160;callStack.put(frame&#160;+&#160;LOC0&#160;+&#160;i,args-&gt;at(i))<br>&#160;&#160;end;<br>&#160;&#160;self.nextToken();<br>&#160;&#160;@While&#160;frame&#160;&gt;=&#160;0&#160;and&#160;not&#160;parseError&#160;do<br>&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;CODE)-&gt;isEmpty<br>&#160;&#160;&#160;&#160;then&#160;self.popFrame()<br>&#160;&#160;&#160;&#160;else&#160;let&#160;instr&#160;=&#160;self.popInstrs()&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caseObj&#160;=&#160;instr&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;caseObjType&#160;=&#160;caseObj.of()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;caseObjType&#160;=&#160;NewToken<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;tokenNumber&#160;=&#160;caseObj.tokenNumber&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name&#160;=&#160;caseObj.name<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Try&#160;NewToken&#160;",name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;tokenNumber&#160;&lt;&gt;&#160;type<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug1("Fail&#160;NewToken&#160;",token);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail(name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Consume&#160;",token)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;token.toString();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;PopChar<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.popChar()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;PushChar<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.pushChar()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;LinePos<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.RESULT&#160;:=&#160;self.linePos()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Pair<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;tailIndex&#160;=&#160;caseObj.tailIndex&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;headIndex&#160;=&#160;caseObj.headIndex<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.RESULT&#160;:=&#160;Seq{callStack.ref(frame&#160;+&#160;7&#160;+&#160;headIndex)&#160;|&#160;callStack.ref(frame&#160;+&#160;7&#160;+&#160;tailIndex)}<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;VarRef<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;index&#160;=&#160;caseObj.index&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name&#160;=&#160;caseObj.name<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.RESULT&#160;:=&#160;callStack.ref(frame&#160;+&#160;7&#160;+&#160;index)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Const<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;value&#160;=&#160;caseObj.value<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.RESULT&#160;:=&#160;value<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;TypeCheck<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;type&#160;=&#160;caseObj.type<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.typeCheck(type)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Term<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug0("Try&#160;Term&#160;")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;type&#160;&lt;&gt;&#160;TERM<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug1("Fail&#160;Term&#160;",token);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail("Term")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Consume&#160;",token)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;token.toString();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Chars<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.readChars()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Line<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.readLine()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Char<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.readChar()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;PState<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.RESULT&#160;:=&#160;self<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;ImportAt<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.imports&#160;:=&#160;Seq{self.atNameSpace()&#160;|&#160;self.imports}<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Terminal<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;terminal&#160;=&#160;caseObj.terminal<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Try&#160;Terminal&#160;",terminal)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;not&#160;token.stringEqual(terminal)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug3("Fail&#160;Terminal&#160;",terminal,"&#160;&lt;&gt;&#160;",token);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail(terminal)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Consume&#160;",token)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;consumeToken<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Tok<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.RESULT&#160;:=&#160;Token(type,token.toString(),tokenizer.charPos(),tokenizer.lineCount(),tokenizer.charCount(),"")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Cons<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;tailIndex&#160;=&#160;caseObj.tailIndex&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;headIndex&#160;=&#160;caseObj.headIndex<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.RESULT&#160;:=&#160;Seq{callStack.ref(frame&#160;+&#160;LOC0&#160;+&#160;headIndex)&#160;|&#160;callStack.ref(frame&#160;+&#160;LOC0&#160;+&#160;tailIndex)}<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Nil<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.RESULT&#160;:=&#160;Seq{}<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Cut<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.cut()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;SetLoc<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;index&#160;=&#160;caseObj.index<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;callStack.put(frame&#160;+&#160;LOC0&#160;+&#160;index,RESULT)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Predicate<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;predicate&#160;=&#160;caseObj.predicate<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;predicate(callStack,frame)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug0("Predicate&#160;OK")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;self.fail("Predicate")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Action<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;action&#160;=&#160;caseObj.action<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.RESULT&#160;:=&#160;action(callStack,frame);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.setLocation(RESULT);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug1("Action:&#160;",RESULT)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;EOF<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug0("Try&#160;EOF");<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;type&#160;&lt;&gt;&#160;EOI<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug2("Fail&#160;EOF&#160;",token,type);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail("EOF")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;self.debug0("Succeed&#160;EOF&#160;")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Str<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug0("Try&#160;Str");<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;type&#160;&lt;&gt;&#160;STRING<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug0("Fail&#160;Str");<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail("Str")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Succeed&#160;Str&#160;",token)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;token.toString();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Name<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug0("Try&#160;Name")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;name&#160;=&#160;token.toString()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;if&#160;type&#160;&lt;&gt;&#160;NAME&#160;orelse&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).terminals()-&gt;includes(name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug2("Fail&#160;Name:&#160;",token,type);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail("Name")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Succeed&#160;Name&#160;",token)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;name;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Float<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug0("Try&#160;Float")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;type&#160;&lt;&gt;&#160;FLOAT<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug0("Fail&#160;Float");<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail("Float")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Succeed&#160;Float&#160;",token)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;token.toString().asFloat();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Int<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug0("Try&#160;Int")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;type&#160;&lt;&gt;&#160;INT<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug0("Fail&#160;Int");<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail("Int")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.debug1("Succeed&#160;Int&#160;",token)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;token.toString().asInt();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;Call<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;let&#160;argMap&#160;=&#160;caseObj.argMap&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;name&#160;=&#160;caseObj.name&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;grammar&#160;=&#160;callStack.ref(frame&#160;+&#160;GRAMMAR);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;indent&#160;=&#160;callStack.ref(frame&#160;+&#160;INDENT)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.call(grammar,indent,name,argMap,self.code()-&gt;isEmpty)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;elseif&#160;caseObjType&#160;=&#160;At<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.atPath();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;classifier&#160;=&#160;self.atClassifier()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.startAt(classifier)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;self.error("Unknown&#160;instruction&#160;"&#160;+&#160;instr.toString())<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end;<br>&#160;&#160;RESULT<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="parse"/><FONT FACE="Courier" SIZE="1">@Operation&#160;parse(target&#160;:&#160;XCore::Element,grammar&#160;:&#160;XCore::Element,code&#160;:&#160;XCore::Element,tokenizer&#160;:&#160;XCore::Element,imports&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;self.parse(Seq{},target,grammar,code,tokenizer,imports)<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="parseError"/><FONT FACE="Courier" SIZE="1">@Operation&#160;parseError[ACCESSOR=true]():XCore::Element<br>&#160;&#160;self.parseError<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="popChar"/><FONT FACE="Courier" SIZE="1">@Operation&#160;popChar():XCore::Element<br>&#160;&#160;self.charPosStack&#160;:=&#160;charPosStack-&gt;tail<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="popFail"/><FONT FACE="Courier" SIZE="1">@Operation&#160;popFail():XCore::Element<br>&#160;&#160;let&#160;blocks&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_CODE);<br>&#160;&#160;&#160;&#160;&#160;&#160;prev&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_PREV);<br>&#160;&#160;&#160;&#160;&#160;&#160;grammar&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_GRAMMAR);<br>&#160;&#160;&#160;&#160;&#160;&#160;indent&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_INDENT);<br>&#160;&#160;&#160;&#160;&#160;&#160;target&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_TARGET);<br>&#160;&#160;&#160;&#160;&#160;&#160;cut&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_CUT);<br>&#160;&#160;&#160;&#160;&#160;&#160;name&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_NAME);<br>&#160;&#160;&#160;&#160;&#160;&#160;charPos&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_CHARPOS);<br>&#160;&#160;&#160;&#160;&#160;&#160;oldCharPosStack&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_CS_SIZE)<br>&#160;&#160;in&#160;failStack.put(fail&#160;+&#160;FAIL_CODE,blocks-&gt;tail);<br>&#160;&#160;&#160;&#160;&#160;self.token&#160;:=&#160;failStack.ref(fail&#160;+&#160;FAIL_TOKEN);<br>&#160;&#160;&#160;&#160;&#160;self.type&#160;:=&#160;failStack.ref(fail&#160;+&#160;FAIL_TYPE);<br>&#160;&#160;&#160;&#160;&#160;if&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;&#160;&#160;&#160;then&#160;format(stdout,"~VRetry&#160;~S~%",Seq{indent,name})<br>&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;end&#160;;<br>&#160;&#160;&#160;&#160;&#160;self.TOCS&#160;:=&#160;prev&#160;+&#160;callStack.ref(prev&#160;+&#160;LOCALS)&#160;+&#160;LOC0;<br>&#160;&#160;&#160;&#160;&#160;self.frame&#160;:=&#160;self.pushCall(prev,grammar,blocks-&gt;head.instrs(),indent,target,cut,blocks-&gt;head.locals());<br>&#160;&#160;&#160;&#160;&#160;@Count&#160;i&#160;from&#160;0&#160;to&#160;failStack.ref(fail&#160;+&#160;FAIL_ARGS)&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;arg&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_ARG0&#160;+&#160;i);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;local&#160;=&#160;blocks-&gt;head.argMap()-&gt;at(i)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;callStack.put(frame&#160;+&#160;LOC0&#160;+&#160;local,arg)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;end;<br>&#160;&#160;&#160;&#160;&#160;self.unwindFail();<br>&#160;&#160;&#160;&#160;&#160;tokenizer.setCharPos(charPos);<br>&#160;&#160;&#160;&#160;&#160;self.charPosStack&#160;:=&#160;oldCharPosStack<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="popFrame"/><FONT FACE="Courier" SIZE="1">@Operation&#160;popFrame():XCore::Element<br>&#160;&#160;self.frame&#160;:=&#160;callStack.ref(frame&#160;+&#160;PREV_FRAME);<br>&#160;&#160;if&#160;frame&#160;&gt;=&#160;0&#160;andthen&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).debug<br>&#160;&#160;then&#160;format(stdout,"~VReturn&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;INDENT),RESULT})<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;;<br>&#160;&#160;if&#160;fail&#160;&gt;=&#160;0&#160;andthen&#160;failStack.ref(fail&#160;+&#160;FAIL_PREV)&#160;&gt;=&#160;frame<br>&#160;&#160;then&#160;let&#160;frame&#160;=&#160;failStack.ref(fail&#160;+&#160;FAIL_PREV)&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;locals&#160;=&#160;callStack.ref(frame&#160;+&#160;LOCALS)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.TOCS&#160;:=&#160;frame&#160;+&#160;LOC0&#160;+&#160;locals<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;else&#160;self.TOCS&#160;:=&#160;frame&#160;+&#160;LOC0&#160;+&#160;callStack.ref(frame&#160;+&#160;LOCALS)<br>&#160;&#160;end&#160;;<br>&#160;&#160;if&#160;frame&#160;&gt;=&#160;0&#160;andthen&#160;(not&#160;callStack.ref(frame&#160;+&#160;CODE)-&gt;isEmpty)&#160;andthen&#160;fail&#160;&gt;=&#160;0&#160;andthen&#160;failStack.ref(fail&#160;+&#160;FAIL_PREV)&#160;&gt;=&#160;frame<br>&#160;&#160;then&#160;self.dupFrame()<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="popInstrs"/><FONT FACE="Courier" SIZE="1">@Operation&#160;popInstrs():XCore::Element<br>&#160;&#160;let&#160;instrs&#160;=&#160;callStack.ref(frame&#160;+&#160;CODE)<br>&#160;&#160;in&#160;callStack.put(frame&#160;+&#160;CODE,instrs-&gt;tail);<br>&#160;&#160;&#160;&#160;&#160;instrs-&gt;head<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="printFail"/><FONT FACE="Courier" SIZE="1">@Operation&#160;printFail(fail&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;format(stdout,"fail&#160;=&#160;~S~%",Seq{fail});<br>&#160;&#160;format(stdout,"PREV&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;0)});<br>&#160;&#160;format(stdout,"FAIL&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;1)});<br>&#160;&#160;format(stdout,"CHARPOS&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;2)});<br>&#160;&#160;format(stdout,"GRAMMAR&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;3)});<br>&#160;&#160;format(stdout,"CODE&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;4)});<br>&#160;&#160;format(stdout,"INDENT&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;5)});<br>&#160;&#160;format(stdout,"TARGET&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;6)});<br>&#160;&#160;format(stdout,"CUT&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;7)});<br>&#160;&#160;format(stdout,"NAME&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;8)});<br>&#160;&#160;format(stdout,"TOKEN&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;9)});<br>&#160;&#160;format(stdout,"TYPE&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;10)});<br>&#160;&#160;format(stdout,"ARGS&#160;=&#160;~S~%",Seq{failStack.ref(fail&#160;+&#160;11)});<br>&#160;&#160;@Count&#160;i&#160;from&#160;0&#160;to&#160;failStack.ref(fail&#160;+&#160;11)&#160;do<br>&#160;&#160;&#160;&#160;format(stdout,"ARG(~S)&#160;=&#160;~S~%",Seq{i,failStack.ref(fail&#160;+&#160;FAIL_ARG0&#160;+&#160;i)})<br>&#160;&#160;end;<br>&#160;&#160;format(stdout,"~%~%")<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="printFrame"/><FONT FACE="Courier" SIZE="1">@Operation&#160;printFrame(frame&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;format(stdout,"frame&#160;=&#160;~S,&#160;TOS&#160;=&#160;~S~%",Seq{frame,TOCS});<br>&#160;&#160;format(stdout,"PREV&#160;=&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;0)});<br>&#160;&#160;format(stdout,"GRAMMAR&#160;=&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;1)});<br>&#160;&#160;format(stdout,"CODE&#160;=&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;2)});<br>&#160;&#160;format(stdout,"INDENT&#160;=&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;3)});<br>&#160;&#160;format(stdout,"TARGET&#160;=&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;4)});<br>&#160;&#160;format(stdout,"CUT&#160;=&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;5)});<br>&#160;&#160;format(stdout,"LOCALS&#160;=&#160;~S~%",Seq{callStack.ref(frame&#160;+&#160;6)});<br>&#160;&#160;@Count&#160;i&#160;from&#160;0&#160;to&#160;callStack.ref(frame&#160;+&#160;6)&#160;do<br>&#160;&#160;&#160;&#160;format(stdout,"Loc(~S)&#160;=&#160;~S~%",Seq{i,callStack.ref(frame&#160;+&#160;7&#160;+&#160;i)})<br>&#160;&#160;end;<br>&#160;&#160;format(stdout,"~%~%")<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="pushCall"/><FONT FACE="Courier" SIZE="1">@Operation&#160;pushCall(prev&#160;:&#160;XCore::Element,grammar&#160;:&#160;XCore::Element,code&#160;:&#160;XCore::Element,indent&#160;:&#160;XCore::Element,target&#160;:&#160;XCore::Element,cut&#160;:&#160;XCore::Element,locals&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;callStack.put(TOCS&#160;+&#160;PREV_FRAME,prev);<br>&#160;&#160;callStack.put(TOCS&#160;+&#160;GRAMMAR,grammar);<br>&#160;&#160;callStack.put(TOCS&#160;+&#160;CODE,code);<br>&#160;&#160;callStack.put(TOCS&#160;+&#160;INDENT,indent);<br>&#160;&#160;callStack.put(TOCS&#160;+&#160;TARGET,target);<br>&#160;&#160;callStack.put(TOCS&#160;+&#160;CUT,cut);<br>&#160;&#160;callStack.put(TOCS&#160;+&#160;LOCALS,locals);<br>&#160;&#160;self.TOCS&#160;:=&#160;TOCS&#160;+&#160;LOC0&#160;+&#160;locals;<br>&#160;&#160;TOCS&#160;-&#160;(LOC0&#160;+&#160;locals)<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="pushChar"/><FONT FACE="Courier" SIZE="1">@Operation&#160;pushChar():XCore::Element<br>&#160;&#160;self.charPosStack&#160;:=&#160;Seq{tokenizer.charPos()&#160;-&#160;token-&gt;size&#160;|&#160;charPosStack}<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="pushFail"/><FONT FACE="Courier" SIZE="1">@Operation&#160;pushFail(prev&#160;:&#160;XCore::Element,fail&#160;:&#160;XCore::Element,charPos&#160;:&#160;XCore::Element,grammar&#160;:&#160;XCore::Element,code&#160;:&#160;XCore::Element,indent&#160;:&#160;XCore::Element,target&#160;:&#160;XCore::Element,cut&#160;:&#160;XCore::Element,token&#160;:&#160;XCore::Element,type&#160;:&#160;XCore::Element,name&#160;:&#160;XCore::Element,argMap&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_PREV,prev);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_FAIL,fail);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_CHARPOS,charPos);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_GRAMMAR,grammar);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_CODE,code);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_INDENT,indent);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_CUT,cut);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_TOKEN,token);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_TYPE,type);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_NAME,name);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_CS_SIZE,charPosStack);<br>&#160;&#160;failStack.put(TOFS&#160;+&#160;FAIL_ARGS,argMap-&gt;size);<br>&#160;&#160;@Count&#160;i&#160;from&#160;0&#160;to&#160;argMap-&gt;size&#160;do<br>&#160;&#160;&#160;&#160;let&#160;arg&#160;=&#160;callStack.ref(prev&#160;+&#160;LOC0&#160;+&#160;argMap-&gt;at(i))<br>&#160;&#160;&#160;&#160;in&#160;failStack.put(TOFS&#160;+&#160;FAIL_ARG0&#160;+&#160;i,arg)<br>&#160;&#160;&#160;&#160;end<br>&#160;&#160;end;<br>&#160;&#160;self.fail&#160;:=&#160;TOFS;<br>&#160;&#160;self.TOFS&#160;:=&#160;TOFS&#160;+&#160;FAIL_ARG0&#160;+&#160;argMap-&gt;size<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="readChar"/><FONT FACE="Courier" SIZE="1">@Operation&#160;readChar():XCore::Element<br>&#160;&#160;tokenizer.setCharPos(tokenizer.lastCharPos());<br>&#160;&#160;let&#160;char&#160;=&#160;tokenizer.readChar()<br>&#160;&#160;in&#160;if&#160;char&#160;=&#160;256<br>&#160;&#160;&#160;&#160;&#160;then&#160;self.fail("Char")<br>&#160;&#160;&#160;&#160;&#160;else<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;char;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;consumeToken<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;tokenizer.setLastCharPos(tokenizer.charPos())<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="readChars"/><FONT FACE="Courier" SIZE="1">@Operation&#160;readChars():XCore::Element<br>&#160;&#160;tokenizer.setCharPos(tokenizer.lastCharPos());<br>&#160;&#160;let&#160;char&#160;=&#160;tokenizer.readChar()<br>&#160;&#160;in&#160;if&#160;char&#160;=&#160;256<br>&#160;&#160;&#160;&#160;&#160;then&#160;self.fail("Chars")<br>&#160;&#160;&#160;&#160;&#160;else&#160;let&#160;chars&#160;=&#160;Seq{char};<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;reading&#160;=&#160;true<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;@While&#160;reading&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;not&#160;tokenizer.peek("end")<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;char&#160;:=&#160;tokenizer.readChar();<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;char&#160;=&#160;256<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;reading&#160;:=&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;chars&#160;:=&#160;Seq{char&#160;|&#160;chars}<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;reading&#160;:=&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;chars-&gt;reverse;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.nextToken()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="readLine"/><FONT FACE="Courier" SIZE="1">@Operation&#160;readLine():XCore::Element<br>&#160;&#160;tokenizer.setCharPos(tokenizer.lastCharPos());<br>&#160;&#160;let&#160;chars&#160;=&#160;Buffer(80,true);<br>&#160;&#160;&#160;&#160;&#160;&#160;char&#160;=&#160;tokenizer.readChar()<br>&#160;&#160;in&#160;@While&#160;char&#160;&lt;&gt;&#160;256&#160;and&#160;char&#160;&lt;&gt;&#160;"<br>"-&gt;at(0)&#160;and&#160;char&#160;&lt;&gt;&#160;""-&gt;at(0)&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;chars.add(char);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;char&#160;:=&#160;tokenizer.readChar()<br>&#160;&#160;&#160;&#160;&#160;end;<br>&#160;&#160;&#160;&#160;&#160;self.RESULT&#160;:=&#160;chars.toString()<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="reset"/><FONT FACE="Courier" SIZE="1">@Operation&#160;reset():XCore::Element<br>&#160;&#160;self.parseError&#160;:=&#160;false;<br>&#160;&#160;expected.setSize(0);<br>&#160;&#160;self.maxCharPos&#160;:=&#160;0;<br>&#160;&#160;self.frame&#160;:=&#160;0&#160;-&#160;1;<br>&#160;&#160;self.fail&#160;:=&#160;0&#160;-&#160;1;<br>&#160;&#160;self.TOFS&#160;:=&#160;0;<br>&#160;&#160;self.TOCS&#160;:=&#160;0;<br>&#160;&#160;self.imports&#160;:=&#160;Seq{};<br>&#160;&#160;self.consumeToken&#160;:=&#160;true;<br>&#160;&#160;self.charPosStack&#160;:=&#160;Seq{}<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="setExpected"/><FONT FACE="Courier" SIZE="1">@Operation&#160;setExpected[UPDATER=true](v&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;self.expected&#160;:=&#160;v<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="setLocation"/><FONT FACE="Courier" SIZE="1">@Operation&#160;setLocation(value&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;if&#160;value&#160;&lt;&gt;&#160;null&#160;andthen&#160;value.isKindOf(Located)<br>&#160;&#160;then&#160;if&#160;not&#160;(charPosStack-&gt;isEmpty)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;value.charStart&#160;:=&#160;charPosStack-&gt;head;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;value.charEnd&#160;:=&#160;tokenizer.lastCharPos<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;false<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;else&#160;false<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="setParseError"/><FONT FACE="Courier" SIZE="1">@Operation&#160;setParseError[UPDATER=true](v&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;self.parseError&#160;:=&#160;v<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="startAt"/><FONT FACE="Courier" SIZE="1">@Operation&#160;startAt(classifier&#160;:&#160;XCore::Element):XCore::Element<br>&#160;&#160;let&#160;grammar&#160;=&#160;classifier.grammar<br>&#160;&#160;in&#160;if&#160;grammar&#160;=&#160;null<br>&#160;&#160;&#160;&#160;&#160;then&#160;self.error("At:&#160;"&#160;+&#160;classifier.path()&#160;+&#160;"&#160;does&#160;not&#160;define&#160;a&#160;grammar.")<br>&#160;&#160;&#160;&#160;&#160;else&#160;let&#160;name&#160;=&#160;grammar.startingSymbol.toString()<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;self.call(grammar,0,name,Seq{},false)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="toString"/><FONT FACE="Courier" SIZE="1">@Operation&#160;toString():String<br>&#160;&#160;try<br>&#160;&#160;&#160;&#160;self.of().name.toString()&#160;+&#160;"("&#160;+&#160;""&#160;+&#160;")"<br>&#160;&#160;catch(exception)<br>&#160;&#160;&#160;&#160;self.of().name&#160;+&#160;"(Constructor&#160;Error!)"<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="typeCheck"/><FONT FACE="Courier" SIZE="1">@Operation&#160;typeCheck(path&#160;:&#160;Seq(String)):XCore::Element<br>&#160;&#160;let&#160;imports&#160;=&#160;imports&#160;+&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).imports&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;type&#160;=&#160;let&#160;findSeq&#160;=&#160;imports&#160;+&#160;callStack.ref(frame&#160;+&#160;GRAMMAR).imports-&gt;asSeq;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;findDone&#160;=&#160;false;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;findResult&#160;=&#160;null<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;declare(hidden,findSeq);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;declare(hidden,findDone);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;declare(hidden,findResult);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;@While&#160;not&#160;findSeq-&gt;isEmpty&#160;and&#160;not&#160;findDone&#160;do<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;let&#160;nameSpace&#160;=&#160;findSeq-&gt;head&#160;then<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;findElement&#160;=&#160;findSeq-&gt;head<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;in&#160;declare(hidden,findElement);<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;nameSpace.hasElement(path-&gt;head)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;findDone&#160;:=&#160;true;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;findResult&#160;:=&#160;path-&gt;tail-&gt;iterate(name&#160;nameSpace&#160;=&#160;nameSpace.getElement(path-&gt;head)&#160;|<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;nameSpace.hasElement(name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;nameSpace.getElement(name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;throw&#160;NameSpaceRef(nameSpace,name)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;findSeq&#160;:=&#160;findSeq-&gt;tail<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;if&#160;not&#160;findDone<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;then&#160;throw&#160;PathNotFound(path,imports)<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;else&#160;findResult<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;end<br>&#160;&#160;in&#160;if&#160;not&#160;RESULT.isKindOf(type)<br>&#160;&#160;&#160;&#160;&#160;then&#160;<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.debug0(formats("Fail&#160;TypeCheck&#160;~S&#160;:&#160;~{::~;~S~}",Seq{RESULT,path}));<br>&#160;&#160;&#160;&#160;&#160;&#160;&#160;self.fail("Type&#160;Check")<br>&#160;&#160;&#160;&#160;&#160;else&#160;self.debug0("Type&#160;check&#160;"&#160;+&#160;RESULT&#160;+&#160;":"&#160;+&#160;type.path()&#160;+&#160;"&#160;succeeds.")<br>&#160;&#160;&#160;&#160;&#160;end&#160;<br>&#160;&#160;end<br>end</FONT>
</TD></TR>
<TR><TD COLSPAN=2><a name="unwindFail"/><FONT FACE="Courier" SIZE="1">@Operation&#160;unwindFail():XCore::Element<br>&#160;&#160;@While&#160;fail&#160;&gt;=&#160;0&#160;andthen&#160;failStack.ref(fail&#160;+&#160;FAIL_CODE)-&gt;isEmpty&#160;do<br>&#160;&#160;&#160;&#160;self.fail&#160;:=&#160;failStack.ref(fail&#160;+&#160;FAIL_FAIL)<br>&#160;&#160;end;<br>&#160;&#160;if&#160;fail&#160;&gt;=&#160;0<br>&#160;&#160;then&#160;self.TOFS&#160;:=&#160;fail&#160;+&#160;failStack.ref(fail&#160;+&#160;FAIL_ARGS)&#160;+&#160;FAIL_ARG0<br>&#160;&#160;else&#160;self.TOFS&#160;:=&#160;0<br>&#160;&#160;end&#160;<br>end</FONT>
</TD></TR>
</FONT>
</TD>
</TR>
</TABLE>
</HTML>
