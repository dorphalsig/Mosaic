<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<project default="build" basedir="." name="Create Runnable Jar for Project GUI-XMF2 with libraries in sub-folder">

	<!-- 
        Written by Jens Gulden and BjÃ¶rn Benner. ANT 1.7 is required
        This script compiles all .xmf-files, creates afterwards xmf.img as well as mosaic.xmf and creates finally a build.
        It is not necessary to modify paths as this script facilitates only relatives
	-->

	<tstamp/>
	<property name="output" location="output/"/>
	<property name="outputArchive" location="${output}/xmodeler-${DSTAMP}.zip"/>
	<property name="prefix" value="XModeler/"/>
	<!--<property name="eclipse_plugins" location="plugins/eclipse-modeling-neon-1a-win32-x86_64/plugins"/>
	<property name="deltapack_plugins" location="plugins/eclipse-4.4-delta-pack/plugins"/> -->

	<property name="homeDir" location="../../XMF/com.ceteva.xmf.system/xmf-src/"/>
	<property name="compileAll" location="${homeDir}/bin/compileAll.bat"/>
	<property name="makexmf" location="${homeDir}/bin/makexmf.bat"/>
	<property name="makemosaic" location="${homeDir}/bin/makemosaic.bat"/>

	<target name="build">
		<delete file="${outputArchive}" failonerror="no"/>
		<exec executable="cmd">
			<arg value="/c"/>
			<arg value="${compileAll}"/>
			<arg value="${homeDir}"/>
		</exec>
		<exec dir="${homeDir}" executable="cmd">
    	    <arg value="/c"/>
    	    <arg value="${makexmf}"/>
    		<arg value="." />
    	</exec>
	   	<exec dir="${homeDir}" executable="cmd">
    	    <arg value="/c"/>
    	    <arg value="${makemosaic}"/>
    		<arg value="."/>
    	</exec>

		<echo file="${output}/release.txt">XModeler build ${DSTAMP}</echo>
		<zip destfile="${outputArchive}" compress="yes" duplicate="fail">
			<zipfileset dir=".." prefix="${prefix}">
				<include name="bin/**"/>
				<include name="doc/**"/>
				<include name="lib/*.jar"/>
				<include name="lib/poi-3.10.1/*.jar"/>
				<include name="lib/poi-3.10.1/LICENSE"/>
				<include name="lib/poi-3.10.1/NOTICE"/>
				<!--<include name="lib/swt-4.5.*.jar"/>-->
				<exclude name="lib/swt.jar"/>
				<exclude name="lib/swt-3.7.2*.jar"/>
				<exclude name="lib/swt-4.4.*.jar"/>
				<!--<exclude name="lib/servlet-api.jar"/>-->
				<exclude name="lib/org.eclipse.swt.win32.win32.x86_3.7.2.v3740f.jar"/>				
				<include name="Exceptions/**"/>
				<include name="file/**"/>
				<include name="icons/**"/>
				<include name="images/**"/>
				<include name="dejavu/**"/>
				<include name="MDC/**"/>
				<include name="setting/**"/>
				<include name="User/**"/>
				<include name="web/**"/>
				<exclude name="**/.DS_Store"/>
			</zipfileset>
			<zipfileset dir="." prefix="${prefix}">
				<include name="*.txt"/>
				<!-- ini files -->
			</zipfileset>
			<zipfileset dir="." prefix="${prefix}" filemode="755">
				<include name="*.sh"/>
				<!-- start scripts -->
				<include name="*.bat"/>
			</zipfileset>
			<zipfileset dir="../../XMF/com.ceteva.xmf.machine" prefix="${prefix}">
				<include name="bin/**"/>
				<exclude name="**/.DS_Store"/>
			</zipfileset>
			<zipfileset dir="../../XMF/com.ceteva.xmf.system" prefix="${prefix}">
				<include name="xmf-addons/**"/>
				<include name="xmf-src/**"/>
				<include name="xmf-img/**"/>
				<exclude name="**/.DS_Store"/>
			</zipfileset>
			<!-- <zipfileset dir="../../XMF/com.ceteva.xmf.machine" prefix="${prefix}lib/">
				<include name="servlet-api.jar"/>
			</zipfileset>-->
			<!-- from Eclipse -->
			<!-- <zipfileset dir="${eclipse_plugins}" prefix="${prefix}lib/">
				Jface is included in the lib/ of the project Mosaic. Thus, it is not neccessary to include ist
				<include name="org.eclipse.jface_3.10.0.v20140604-0740.jar"/>
				<include name="org.eclipse.osgi_3.10.0.v20140606-1445.jar"/>
				<include name="org.eclipse.osgi.compatibility.state_1.0.0.v20140403-1907.jar"/>
				<include name="org.eclipse.ui.workbench_3.106.0.v20140530-0732.jar"/>
				<include name="org.eclipse.swt_3.103.0.v20140605-2008.jar"/>
			</zipfileset>-->
			<!-- from delta pack -->
			<!--<zipfileset dir="${deltapack_plugins}" prefix="${prefix}lib/">
				<include name="org.eclipse.swt.gtk.linux.x86_3.103.0.v20140605-2012.jar"/>
				<include name="org.eclipse.swt.gtk.linux.x86_64_3.103.0.v20140605-2012.jar"/>
				<include name="org.eclipse.swt.win32.win32.x86_3.103.0.v20140605-2012.jar"/>
				<include name="org.eclipse.swt.win32.win32.x86_64_3.103.0.v20140605-2012.jar"/>
				<include name="org.eclipse.swt.cocoa.macosx_3.103.0.v20140605-2012.jar"/>
				<include name="org.eclipse.swt.cocoa.macosx.x86_64_3.103.0.v20140605-2012.jar"/>
			</zipfileset>-->
			<zipfileset dir="${output}" prefix="${prefix}">
				<include name="release.txt"/>
			</zipfileset>
		</zip>

	</target>
	<!--
	  TODO deploy on Mac conforming to http://www.eclipse.org/swt/macosx/
	-->
</project>
